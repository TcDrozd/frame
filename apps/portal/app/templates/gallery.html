{% extends "base.html" %}
{% block content %}
<h1>Gallery (latest 200)</h1>

<section class="card">
  <div class="row">
    <form method="post" action="{{ request.url_for('gallery_sync_s3') }}" class="inline">
      <button type="submit">Sync from S3</button>
    </form>
    <span class="hint">Imports missing media keys from S3 into the portal DB.</span>
  </div>
  {% if scanned %}
    <div class="hint">Last sync scanned <strong>{{ scanned }}</strong> media objects and imported <strong>{{ synced }}</strong>.</div>
  {% endif %}
  {% if sync_error %}
    <div class="error">{{ sync_error }}</div>
  {% endif %}
</section>

<section class="card">
  <table class="table">
    <thead>
      <tr>
        <th>Uploaded</th>
        <th>Filename</th>
        <th>S3 key</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for p in photos %}
      <tr>
        <td><code>{{ p.uploaded_at }}</code></td>
        <td>{{ p.original_filename or "" }}</td>
        <td><code>{{ p.s3_key }}</code></td>
        <td>{{ "yes" if p.active else "no" }}</td>
        <td class="actions">
          <button hx-post="{{ request.url_for('pin_now', photo_id=p.id) }}" hx-swap="none">Pin now</button>
          <button hx-post="{{ request.url_for('bump', photo_id=p.id) }}" hx-swap="none">Bump</button>
          <button hx-post="{{ request.url_for('hide', photo_id=p.id) }}" hx-swap="none">Hide</button>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
